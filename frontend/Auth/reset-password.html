<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Đặt lại mật khẩu</title>
  <link rel="stylesheet" href="/Auth/style.css">
</head>
<body>
  <div class="card small-card">
    <h2>Đặt lại mật khẩu</h2>
    <form id="resetForm">
      <div class="field">
        <label for="newPassword">Mật khẩu mới</label>
        <input id="newPassword" type="password" required>
      </div>
      <div class="actions">
        <button type="submit" class="primary">Đặt lại</button>
      </div>
      <div id="msg" class="msg"></div>
    </form>
  </div>

  <script type="module">
    import { resetPassword } from '/Auth/auth.js';
    const form = document.getElementById('resetForm');
    const msg = document.getElementById('msg');

    // lấy token & email từ URL
    const params = new URLSearchParams(window.location.search);
    const token = params.get('token');
    const email = params.get('email');

    if (!token || !email) {
      msg.textContent = 'Liên kết không hợp lệ';
    }

    form.onsubmit = async (e) => {
      e.preventDefault();
      msg.textContent = '';
      try {
        const newPassword = document.getElementById('newPassword').value;
        const res = await resetPassword({ email, token, newPassword });
        msg.textContent = res.message || 'Đặt lại thành công';
        msg.style.color = 'green';
        setTimeout(() => window.location.href = '/signin', 1500);
      } catch (err) {
        msg.textContent = err.message || 'Lỗi';
        msg.style.color = 'red';
      }
    };
  </script>
</body>
</html>